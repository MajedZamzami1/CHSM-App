<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="Database.json"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<style>
    th{ 
        color:rgb(255, 255, 255);
            }
</style>

<div class = "row">
	<div class = "col">
		<div class = "card card-body">
			<input id = "search-input" class] form-control" type="text">
		</div>
	</div>	
</div>

<table class="table table-striped">
    <tr  class="bg-info">
		<th data-column="Identification" data-order="desc">ID &#9650</th>
        <th data-column="Name" data-order="desc">Name &#9650</th>
        <th data-column="Surname" data-order="desc">Surname &#9650</th>
        <th data-column="BirthDate" data-order="desc">BirthDate &#9650</th>
		<th data-column="Waiver" data-order="desc">Waiver &#9650</th>
    </tr>
    <tbody id="myTable">    
    </tbody>
</table>
<script>

var Users = []

function fetching(){
fetch("Database.json")
.then(response => {
   return response.json();
})
.then(jsondata => console.log(jsondata))}

const myList = document.querySelector('ul');
const myRequest = new Request('Database.json');

fetch(myRequest)
  .then(response => response.json())
  .then(data => {
    for (const Raider of data.Raiders) {
	  Users.push({"Identification": ID_Generator(Raider.Name,Raider.Surname), "Name":Raider.Name, "Surname": Raider.Surname, "BirthDate": Raider.BirthDate, "Waiver":"No"})
    }
	JSON.stringify(Users)
	buildTable(Users)
  })
  .catch(console.error);

console.log(Users)

$('#search-input').on('keyup', function(){
	var value = $(this).val().toLowerCase()
	console.log('value:',value)
	var data = searchTable(value,Users)
	buildTable(data)
})

$('th').on('click',function(){
	var column = $(this).data('column')
	var order = $(this).data('order')
	var text = $(this).html()
	text = text.substring(0,text.length - 1)
	console.log('Column was clicked!' , column , order)
	if(order == 'desc'){
		$(this).data('order', 'asc')
		Users = Users.sort((a,b) => a[column] > b[column] ? 1 : -1)
		text += '&#9660'
	}else{
		$(this).data('order', 'desc')
		Users = Users.sort((a,b) => a[column] < b[column] ? 1 : -1)
		text += '&#9650'
	}
	$(this).html(text)
	buildTable(Users)
})

function searchTable(value,data){
	var filteredData = []
	for (var i = 0; i < data.length; i++){
		var name = data[i].Name.toLowerCase()
		if (name.includes(value)){
			filteredData.push(data[i])
		}
	}
	return filteredData
}

function buildTable(data){
	var table = document.getElementById('myTable')
	table.innerHTML = ''
	for (var i = 0; i < data.length; i++){
		var row = `<tr>
						<td>${data[i].Identification}</td>
						<td>${data[i].Name}</td>
						<td>${data[i].Surname}</td>
						<td>${data[i].BirthDate}</td>
						<td>${data[i].Waiver}</td>
					</tr>`
		table.innerHTML += row
		}
	}

function ID_Generator(Name, Surname){
	var val = Math.floor(1000 + Math.random() * 9000);
	var ID = Name[0].toLowerCase() + Surname[0].toLowerCase() + val;
	return ID
}

function add(Name, Surname, BirthDate, Waiver){
	var ID = ID_Generator(Name,Surname);
	var temp = true;
	Users.forEach(element => {
		if(element.Name == Name && element.Surname == Surname && element.BirthDate == BirthDate){
			if(element.Identification == ID)
			temp = false
			}
	})
	if (temp == true){
		Users.push({"Identification":ID, "Name":Name, "Surname":Surname, "BirthDate":BirthDate ,"Waiver":"No"})
	};}


add("John", "Doe","08/04/2001")
add('yahya', 'Al Malallah', '01/02/1998')
add('Anna', 'smith', '08/05/2001')
add("Peter", "Jones","05/04/2001")



</script>

</head>
</html>